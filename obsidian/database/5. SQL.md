SQL一開始是data manapulation language
後來已經變成data definition language了


SQL是一個標準, 但每個公司(mySQL, T-SQL...)不一定會用相同方式實現

Catalog是schema的集合

SQL schema
- Identified by schema name
- Includes an authorization identifier and descriptors
Schema elements include
- tables, constraints, views, domains...
Shcema creation example : 
`CREATE SCHEMA COMPANY AUTHORIZATION 'Jsminth'`

在往下建立EMPLOYEE table的話 ： 
`CREATE TABLE COMPANY.EMPLOYEE ...`

Virtual relations(views) : 身分控管的操作,  如學生不應該可以access所有教職員的資料, 或用來提升效率, 減少每次查詢的時間。e.g : `CREATE VIEW ...`

###### data type
- Numeric data type : 長度是固定的, 如int float, ...
- Character-string data type : 是可以變長度的, 通常需要額外設定最大長度
- Bit-string : 可固定可變動, BIT(n) BIT VARYING(n)
- Boolean : TRUE, FALSE, NULL
- DATE : YYYY-MM-DD
- TIMESTAMP : DATE + TIME
- INTERVAL : TIMESTAMP - TIMESTAMP


Domain的設定 ： `CREATE DOMAIN SSN_TYPE AS CHAR(9)`
直接設定SSN_TYPE, 當table使用的時候直接引入SSN_TYPE就好, 後續長度有變動的話直接更改SSN_TYPE就好

Constraints的設定 ： 
- key : primary cannot be duplicate
- Entity : primary key cannot be null
- Referntial : foreign key must have a value



![[tempFileForShare_20250717-105939.jpg]]

CREATE TABLE EMPLOYEE中定義好每個doamin的型態與domain的規則(not null, DEFAULT, CHECK()), 並設定好PRIMARY KEY

CREATE TABLE EDPARTMENT中使用
UNIQUE(Dname)設定為唯一的, 也具有PK的功能但暫不使用。SSN作為FOREIGN KEY關聯到EMPLOYEE上

Domain規則 ： 
- NOT NULL
- CHECK : 檢查條件, e.g : CHECK(Dnumber > 0 AND Dnumber )
- DEFAULT  : 沒有設定時的default值


FOREIGN KEY 相關的CONSTRAIN
- Default opertaiton : reject update on violation
- Attach referentil triggered action clause(設定violation時的行為)
	- 行為 ：  SET NULL, CASCADE, SET DEFAULT
	- 時機 ： ON DELETE, ON UPDATE

自定義CONSTRAINT的名稱也是可以被允許的, 可以先在其他地方定義好在定義FOREIGN KEY時做使用

### DML

###### SELECT

SQL allows a table to have two or more tuples that are identical in all their attribute values
- 總是以tuple為角度來看運作邏輯
- 有可能是multiset

SELECT {attribute list}
FROM {table list}
WHERE {condition}

e.g. 找出employees works for 'Reaserach' department
```
SELECT Fname, Lname, Address
FROM RMPLOYEE, DEPARTMENT
WHERE Dname == 'Research' AND Dnumber == Dno;
```

e.g. 找出project的 located 在 'stafford' 且找到控制該department的manager
```
SELECT Pnumber, Dnum, Lname, Address, Bdate
FROM PROJECT, DEPARTMENT, EMPLOYEE
WHERE Dnum == Dnumber AND Mger_ssn == Ssn AND Plocation == 'Stafford'
```

###### Aliasing, and Rename
有可能會有不同表格存在相同欄位名稱的問題, 此時需要將table命名別名來解決

```
SELECT e.name, d.name, Address
FROM EMPLOYEE e, DEPARTMENT d
WHERE d.name == 'Research' AND d.number == e.number;
```


Cross purduct problem
e.g.
```
SELECT Ssn, Dname
FROM EMPLOYEE, DEPARTMENT;
```
在沒有對接得情形下會把所有結果呈現出來, 如果是1000個員工與10個department就會出現1000 * 10個結果
要使用join來解決而不是FROM兩個table

( * )  代表全都要 

```
SELECT *
FROM EMPLOYEE
WHERE Dno == 5;
```

```
SELECT *
FROM EMPLOYEE, DEPARTMENT;
```
會很可怕XD


DISTINCT 可以除冗
```
SELECT ALL Salary
FROM EMPLOYEE;

SELECT DISTINCT Salary
FROM EMPLOYEE;
```

###### Table as Set
Set ops : 
- UNION, EXCEPT, INTERSECT
```
SELECT DISTINCE Pnumber
FROM PROJECT, DEPARTMENT, EMPLOYEE
WHERE Dnum === Dnumber AND Mgr_ssn == Ssn
		AND Lname == 'Smith'

UNION

SELECT DISTINCE Pnumber
FROM PROJECT, WORKS_ON, EMPLOYEE
WHERE Pnumber == Pno AND Essn == Ssn
		AND Lname == 'Smith'
```
注意, 兩邊的連結要一樣的(DISTINCE Pnumber)才能UNION


###### String Ops
LIKE : 
- % 表示接不限字數
- _ 表示單一char
```
WHERE Address LIKE '%Houston, TX%';

WHERE Ssn LIKE '__1__8901';
```

BETWEEN : 
```
WHERE(Salary BETWEEN 30000 AND 50000)
```

###### Arithmetic Ops
- + - * /   may be included as a part of SELECT
```
SELECT E.Fname, E.Lname, 1.1 * E.Salary AS Increased_sal
FROM EMPLOYEE AS E, WORKS_ON AS W, PROJECT AS P
WHERE E.Ssn == W.Essn AND W.Pno == P.Pnumber AND P.Pname == 'ProductX';
```


###### Ordering 
- ORDER BY 
- DESC, ASC 放在ORDER BY 後面
```
ORDER BY D.Dname DESC, E.Lname ASC, E.Fname ASC
```

#####  modify commnad
- INSERT, DELETE, UPDATE

###### INSERT
```
INSERT INTO EMPLOYEE
VALUES ('Richard", 'K', 'Marini', '138513634', 1962-12-30')


-- 從己有新增的多筆資料
INSERT INTO EMPLOYEE(Emp_name, Proj_name, Hours_per_week)
SELECT E.Lname, P.Pname, W.Hours
FROM EMPLOYEE AS E, WORKS_ON AS W, PROJECT AS P
WHERE E.Ssn == W.Essn AND W.Pno == P.Pnumber; 
```

CREATE也可以當作廣義的insert
```
CREATE TABLE D5EMPS LIKE
	(SELECT E.*
	FROM EMPLOYEE AS E
	WHERE E.Dno==5)
WITH DATA;
```

###### DELETE
注意要DELETE的entity的規則, 如CASCADE, CHECK等

```
DELETE FROM EMPLOYEE
WHERE Lname == 'Brown';

DELETE FROM EMPLOYEE
WHERE Dno == '5';

DELETE FROM EMPLOYEE;  -- 全殺
```

> DELETE 沒有WHERE很可怕, JOIN也是


###### UPDATE
一樣跟DELETE要小心rules會不會有問題

```
UPDATE PROJECT
SET PLOCATION = 'Bellaire',
	Dnum = 5
WHERE Pnumber == 10;

UPDATE EMPLOYEE
SET SALARY = SALARY*1.1
WHERE Dno IN(SELECT Dnumber
			FROM DEPARTMENT
			WHERE Dname == 'Research)


```
